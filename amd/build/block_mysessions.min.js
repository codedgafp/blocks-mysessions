define(["jquery","local_mentor_core/pagination","format_edadmin/format_edadmin"],function(e,o,i){var n={init:function(s){e(".block_mysessions .training-sheet .list-sessions .target-header-title").text(M.util.get_string("session","block_mysessions")),null===document.getElementById("title-sessions")?e("#show-completed-session").css("position","static"):e("#show-completed-session").css("position",""),this.initPagination(s?".block-session-tile":".block-session-tile:not(.is-completed)"),e(".block_mysessions .session-more-information").on("click",function(s){s.preventDefault(),s.stopPropagation();s=e(s.currentTarget).data().sessionId;window.location.href=M.cfg.wwwroot+"/local/trainings/pages/training.php?sessionid="+s}),e("#input-show-completed-session").click(function(s){e.ajax({url:M.cfg.wwwroot+"/local/user/ajax/ajax.php",data:{controller:"user",action:"set_user_preference",preferencename:"block_mysessions_completed",value:e(s.target).is(":checked")?"1":"0"}}),e(".block_mysessions .block-session-tile").hide(),e("#mysessions-pagination").show(),n.initPagination(e(s.target).is(":checked")?".block-session-tile":".block-session-tile:not(.is-completed)")}).prop("checked",s),e(".block_mysessions .fav").on("click",function(s){s.preventDefault(),s.stopPropagation();var s=e(s.currentTarget),o=s.parent().data("sessionId");e(s).hasClass("fa-star-o")?n.addFavourite(s,o):n.removeFavourite(s,o)}),e(".block_mysessions .fav").on("keydown",function(s){13!=s.which&&32!==s.which||(s.preventDefault(),s.stopPropagation(),s=e(s.currentTarget),e(s).click())}),e(document).on("keydown",".block_mysessions .block-session-tile",function(s){32===s.which&&(s.preventDefault(),this.click())}),e(document).on("keydown",".block_mysessions .session-more-information",function(s){13!=s.which&&32!==s.which||(s.preventDefault(),s.stopPropagation(),e(this).click())})},addImages:function(){e(".block_mysessions .block-session-tile:visible").each(function(){var s=e(this).find("div.session-tile-thumbnail-resize"),o=s.attr("data-thumbnail-url");s.css("background-image","url("+o+")")})},initPagination:function(s){o.initPagination(e(".block_mysessions "+s),e("#mysessions-pagination"),12,!0,this.addImages)},addFavourite:function(o,s){i.ajax_call({url:M.cfg.wwwroot+"/blocks/mysessions/ajax/ajax.php",plugintype:"blocks",controller:"session_favourite",action:"add_favourite",format:"json",sessionid:s,callback:function(s){(s=JSON.parse(s)).success?s.message&&(e(o).removeClass("fa-star-o"),e(o).addClass("fa-star"),e(o).prop("title",M.util.get_string("removefavourite","block_mytrainings"))):console.error(s.message)}})},removeFavourite:function(o,s){i.ajax_call({url:M.cfg.wwwroot+"/blocks/mysessions/ajax/ajax.php",plugintype:"blocks",controller:"session_favourite",action:"remove_favourite",format:"json",sessionid:s,callback:function(s){(s=JSON.parse(s)).success?s.message&&(e(o).removeClass("fa-star"),e(o).addClass("fa-star-o"),e(o).prop("title",M.util.get_string("addfavourite","block_mytrainings"))):console.error(s.message)}})}};return window.block_mysessions=n});