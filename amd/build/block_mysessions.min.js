define(["jquery","local_mentor_core/pagination","format_edadmin/format_edadmin"],function($,pagination,format_edadmin){var block_mysessions={init:function(showsessioncompleted){$(".block_mysessions .training-sheet .list-sessions .target-header-title").text(M.util.get_string("session","block_mysessions"));if(document.getElementById("title-sessions")===null){$("#show-completed-session").css("position","static")}else{$("#show-completed-session").css("position","")}this.initPagination(showsessioncompleted?".block-session-tile":".block-session-tile:not(.is-completed)");$(".block_mysessions .session-more-information").on("click",function(event){event.preventDefault();event.stopPropagation();var sessionId=$(event.currentTarget).data().sessionId;window.location.href=M.cfg.wwwroot+"/local/trainings/pages/training.php?sessionid="+sessionId});$("#input-show-completed-session").click(function(e){$.ajax({url:M.cfg.wwwroot+"/local/user/ajax/ajax.php",data:{controller:"user",action:"set_user_preference",preferencename:"block_mysessions_completed",value:$(e.target).is(":checked")?"1":"0"}});$(".block_mysessions .block-session-tile").hide();$("#mysessions-pagination").show();block_mysessions.initPagination($(e.target).is(":checked")?".block-session-tile":".block-session-tile:not(.is-completed)")}).prop("checked",showsessioncompleted);$(".block_mysessions .fav").on("click",function(event){event.preventDefault();event.stopPropagation();var currentTarget=$(event.currentTarget);var sessionId=currentTarget.parent().data("sessionId");if($(currentTarget).hasClass("fa-star-o")){block_mysessions.addFavourite(currentTarget,sessionId)}else{block_mysessions.removeFavourite(currentTarget,sessionId)}});$(".block_mysessions .fav").keypress(function(event){if(event.which==13){var currentTarget=$(event.currentTarget);$(currentTarget).click()}})},addImages:function(){$(".block_mysessions .block-session-tile:visible").each(function(){var thumbnailDiv=$(this).find("div.session-tile-thumbnail-resize");var thumbnailUrl=thumbnailDiv.attr("data-thumbnail-url");thumbnailDiv.css("background-image","url("+thumbnailUrl+")")})},initPagination:function(elementBlock){pagination.initPagination($(".block_mysessions "+elementBlock),$("#mysessions-pagination"),12,true,this.addImages)},addFavourite:function(currentTarget,sessionId){format_edadmin.ajax_call({url:M.cfg.wwwroot+"/blocks/mysessions/ajax/ajax.php",plugintype:"blocks",controller:"session_favourite",action:"add_favourite",format:"json",sessionid:sessionId,callback:function(response){response=JSON.parse(response);if(!response.success){console.error(response.message);return}var responseData=response.message;if(responseData){$(currentTarget).removeClass("fa-star-o");$(currentTarget).addClass("fa-star");$(currentTarget).prop("title",M.util.get_string("removefavourite","block_mytrainings"))}}})},removeFavourite:function(currentTarget,sessionId){format_edadmin.ajax_call({url:M.cfg.wwwroot+"/blocks/mysessions/ajax/ajax.php",plugintype:"blocks",controller:"session_favourite",action:"remove_favourite",format:"json",sessionid:sessionId,callback:function(response){response=JSON.parse(response);if(!response.success){console.error(response.message);return}var responseData=response.message;if(responseData){$(currentTarget).removeClass("fa-star");$(currentTarget).addClass("fa-star-o");$(currentTarget).prop("title",M.util.get_string("addfavourite","block_mytrainings"))}}})}};window.block_mysessions=block_mysessions;return block_mysessions});